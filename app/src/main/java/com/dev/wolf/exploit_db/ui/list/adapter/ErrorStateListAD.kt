package com.dev.wolf.exploit_db.ui.list.adapter

import androidx.core.view.isVisible
import com.dev.wolf.exploit_db.databinding.ItemErrorStateBinding
import com.dev.wolf.exploit_db.ui.list.model.ErrorState
import com.dev.wolf.exploit_db.ui.list.model.ListModel
import com.dev.wolf.exploit_db.utils.ext.getDisplayMessage
import com.hannesdorfmann.adapterdelegates4.dsl.adapterDelegateViewBinding

fun errorStateListAD(
    onRetryClick: (Throwable) -> Unit
) = adapterDelegateViewBinding<ErrorState, ListModel, ItemErrorStateBinding>(
    { inflater, parent -> ItemErrorStateBinding.inflate(inflater, parent, false) }
) {

    binding.buttonRetry.setOnClickListener {
        onRetryClick(item.exception)
    }

    bind {
        with(binding.textViewError) {
            text = item.exception.getDisplayMessage(context.resources)
            setCompoundDrawablesWithIntrinsicBounds(0, item.icon, 0, 0)
        }
        with(binding.buttonRetry) {
            isVisible = item.canRetry
            setText(item.buttonText)
        }
    }
}