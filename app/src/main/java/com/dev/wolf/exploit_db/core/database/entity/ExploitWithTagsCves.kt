package com.dev.wolf.exploit_db.core.database.entity

import androidx.room.Embedded
import androidx.room.Junction
import androidx.room.Relation
import com.dev.wolf.exploit_db.utils.ext.mapToSet

data class ExploitWithTagsCves(
    @Embedded val exploit: ExploitEntity,
    @Relation(
        parentColumn = "exploit_id",
        entityColumn = "tag_id",
        associateBy = Junction(ExploitTagsEntity::class)
    )
    val tags: List<TagEntity>,
    @Relation(
        parentColumn = "exploit_id",
        entityColumn = "cve_id",
        associateBy = Junction(ExploitCvesEntity::class)
    )
    val cves: List<CveEntity>

) {
    fun toExploit() = exploit.toExploit(tags.mapToSet {it.toTag()}, cves.mapToSet {it.toCVE()})
}